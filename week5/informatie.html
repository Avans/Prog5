<div class="col-md-6">
		
		<section class="preHeader">
		 	<h2>Lesstof week 5 - &quot;Entity Framework&quot;</h2>
		</section>
		
		<article class="sample shadow-z-1" id="inleiding">
			<section class="header">
				<span>Inleiding</span>
			</section>
			
			<section class="main">
				
				<p>Tot nu toe hebben we het model kleinschalig toegepast met een aantal klassen en wat dummy data.
				We willen natuurlijk meer doen met deze data. De meest logische stap is het aansluiten van een
				<b>‘Persistant Store’</b> zoals bijvoorbeeld een <b>database</b>.
				</p>
				
				
				<img src="week5/img/domain_3.png" class="responsive" />
				<p>
					Om dit voor elkaar te krijgen op een mooie manier, hebben we een domein model nodig die we
					kunnen mappen op een database. Je kunt de logica voor het mappen van je data zelf bouwen of je
					gebruikt hier voor een Object Relational Mapper (ORM).
				</p>
				<p>
				Wij gaan gebruik maken van het ORM &quot;Entity Framework&quot;.
				Hieronder staat alvast een kleine review en later gaan we
				meer in op de details.
				</p>
				
			</section>
			
			<section class="footer">
				
				
			</section>
		
		</article>
		
		<article class="sample shadow-z-1" id="domain">
			<section class="header">
				<span>Domein model</span>
			</section>
			
			<section class="main">
				<p>Zoals eerder besproken is een domein model verantwoordelijk voor alle entiteiten binnen een
				applicatie. Een mooie oplossing is het definiëren van deze entiteiten in een losse Assembly.
				Binnen .NET kun je hier het beste een Class Library voor gebruiken. Indien je vanuit andere solutions
				of projecten gebruik wil maken van deze entiteiten, hoef je alleen een referentie toe te voegen naar
				de .dll van je domein model.
				</p>
				Je project komt er dan zo uit te zien:
				
				<div class="row top-buffer">
					<div class="col-md-4">
						<img src="week5/img/domain_1.png" class="responsive" />
					</div>
					<div class="col-md-8">
						<!-- Code snippet -->
						<pre class="prettyprint linenums">
namespace DomainModel
{
    public class Product
    {
        public int ProductID { get; set; }
        public string Name { get; set; }
        public string Color { get; set; }
        public decimal ListPrice { get; set; }
    }
}
						</pre>
					</div>
				</div>

				<p>
					<i><b>Tip</b>: We willen straks vanuit een andere Assembly bij de interface kunnen dus hij moet public zijn.</i>
				</p>

			</section>
		</article>
		
		<article class="sample shadow-z-1" id="entity">
			<section class="header">
				<span>&quot;Entity Framework&quot;</span>
			</section>
			
			<section class="main">
				
				<p>
					Het aansluiten van een database is bijna altijd het zelfde werk. Objecten maken die tabellen in je database reflecteren en query’s uitvoeren om daarna 
					de data uit de database te mappen op je objecten. &quot;Entity Framework&quot; is een <b>Object Relational Mapper (ORM)</b> die dit voor je oplost. Het zorgt er voor dat je maar een keer je data-model hoeft te defineren (code of database) . De rest zal &quot;Entity Framework&quot; voor je genereren. 

				</p>
				
				<img src="week5/img/domain_2.png" class="responsive" />
				
				<p>
					Er zijn verder veel meer eigenschappen van ORM’s en &quot;Entity Framework&quot; die we tijdens deze workshop niet gaan bespreken. 
					Er is veel over te vinden op het grote internet!
					Daarnaast zijn er een aantal leuke tutorial’s die je kunt volgen als je er echt mee wil gaan werken. 
					Hieronder vind je een overzicht van de 3 mogelijke manieren om te werken met &quot;Entity Framework&quot; + een link naar de bron / tutorial. 
					
					<ul>
						<li>Model First</LI>
						<li>Code First</li>
						<li>Database First</li>
					</ul>
				</p>
				
				
				<p>Alleen het concept achter <b>Code First</b> wordt verder uitgelegd in dit webdictaat. 
                    <br />
                    De mogelijkheden zijn: 
				
				<h3>Model first</h3>
				<p>
					&quot;Entity Framework&quot; biedt een mooie tool voor het bewerken van je data-model. Als je geen fan bent van het werken in SQL management studio dan is dit een prettige manier van het bewerken van je data-model. Daarentegen heb je geen volledige toegang tot je data-model aangezien deze gegenereerd wordt door een tool.
				</p>

				<h3>Code first</h3>
				
				<p>Het geeft je volledig toegang tot je entiteiten (modellen) en de code er achter. Op basis van deze code wordt er 
                    een database gegenereerd. 
					In principe is dit een goed systeem wanneer je kleine hoeveelheden data nodig hebt en de database alleen voor dat programma nodig is.
				</p>
				
				<p><b>Link:</b> <a target="_blank"  href="http://msdn.microsoft.com/nl-nl/data/jj193542.aspx">http://msdn.microsoft.com/nl-nl/data/jj193542.aspx<a/>
				</p>
				
				
				<h3>Database first</h3>

				<p>
					 Als je een bestaande database hebt is dit ideaal. Op basis van een bestaande database zal Entity Framework een volledig data-model generen. Deze functie werkt heel goed. Daarnaast is het praktisch om wijzigingen door te voeren vanuit SQL server management studio, en nadat je klaar bent met je data-model, deze wijzigingen ook door te voeren in je applicatie.
				</p>
				
			

			</section>
		</article>
		
		<article class="sample shadow-z-1" id="nuget">
			<section class="header">
				<span>NuGet</span>
			</section>
			<section class="main">
					<p>
						We zouden de Assemblies van &quot;Entity Framework&quot; kunnen downloaden en er handmatig een referentie naar kunnen leggen vanuit ons project. 
						Daarentegen bestaat het Entity Framework uit meerdere assemblies en is de kans dat je een assembly vergeet aanwezig. 
						Gelukkig is er een beter alternatief!
					</p>
					<p> 
						Visual Studio biedt je de mogelijkheid om zogenaamde ‘packages’ te downloaden via NuGet. 
					</p>
					<p>
						<b>Link:</b> <a target="_blank" href="http://weblogs.asp.net/sreejukg/nuget-package-manager-in-visual-studio-2012">http://weblogs.asp.net/sreejukg/nuget-package-manager-in-visual-studio-2012<a/>
					</p>
					<p>
						Je kunt op twee verschillende manieren een package vinden en installeren. 
					</p>
					
					<div class="row split">
						<div class="col-md-6">
							<h4>NuGet Package Manager</h4>
							<p>Je kunt aan je solutions refrences toevoegen maar je hebt ook de mogelijkheid om in een keer een volledige package toe te voegen. </p>
							<img src="week5/img/nuget_1.png" class="responsive">
							<p class="top-buffer">Vanuit deze GUI kun je opzoek naar packages die je wil toevoegen aan je project zoals bijvoorbeeld &quot;Entity Framework&quot;.</p>
							<img  src="week5/img/nuget_2.png" class="responsive">
	
						</div>
						<div class="col-md-6">
							
							<h4>Package Manager Console</h4>

							<p>Er is ook de optie om via je package manager console een package te installeren. </p>
							
							<p>Je kunt de window vinden onder:</p>
							
							<p><b>View > Other Windows > Package Manager Console</b></p>
							
							<p>Dit doe je met het commando:</p>
							
							<p><b>Install-package “package-name”</b></p>
							
							<p>De namen van package + het install comando staan vaak op de website waar je de package gevonden hebt beschreven. </p>
							
							<p>Het commando voor het installeren van &quot;Entity Framework&quot; is bijvoorbeeld: </p>
							
							<p><b>Install-package EntityFramework</b></p>

							<img  src="week5/img/nuget_3.png" class="responsive">
							
						</div>
					</div>
											
					<p>
						Nu &quot;Entity Framework&quot; geïnstalleerd is kunnen we gaan code kloppen!</p>
					</p>
					
				</section>
		</article>
			
		
		<article class="sample shadow-z-1" id="codefirst">
			<section class="header">
				<span>Code First - Stappenplan</span>
			</section>
			

			
			<section class="main">
				<p>
					Dit is een van de favoriete manier van de studenten van vorig jaar.
					Je hoeft je geen zorgen meer te maken over databases, maar doet alles vanuit de code.
					Wat hebben we nodig om dit voor elkaar te krijgen?
				</p>
<!--				
						<h2>Regular</h2>
<button class="btn btn-fab btn-raised btn-inverse "><i class="mdi-navigation-arrow-forward"></i></button>
				-->
				
			</section>
			<section class="hard sub">
			
				<div class="row text-center">
					<div class="col-md-6">
						
						<h4>Warning</h4>
						<p> 
							Code first maakt gebruik van de console-package manager om databases te genereren. 
							Ja je leest het goed. <b>Consoles.</b> 
							Er zijn maar een paar commands nodig om &quot;Entity Framework&quot; aan de praat te krijgen. 
						</p>
					</div>
					<div class="col-md-6">
						<img src="week5/img/warning.png" class="responsive" />
					</div>
				</div>
			</section>
			<section class="main">
				<p>
					&quot;Entity Framework&quot; zorgt er voor dat je niet meer te maken hebt met een database. Daarentegen praten we rechtstreeks 
                    met objecten van het &quot;Entity Framework&quot;. 
					De opbouw van het object valt te vergelijken met een database. 
					Normaliter heb je 1 database met daarin meerdere tabellen. 
					Hieronder staat een korte beschrijving van de meest belangrijke onderdelen van het &quot;Entity Framework&quot;</p>
				</p>
				
				<h4>Database</h4>
				
				<p>
				Het meest belangrijke object waar we mee te maken krijgen is de <b>DbContext</b> class. 
				Dit is een klasse waar je jouw eigen implementatie van kunt maken en waarin alle referenties naar de tabellen (collecties?) staan.
				</p>
				
				<h4>Tables</h4>
				<p>
					Het tweede object waar we gebruik van gaan maken is de klasse <b>DbSet</b>. 
					Dit is een generieke lijst van objecten die uiteindelijk gemapt gaan worden op een Tabel in je database. 
					Deze kun je gebruiken in je eigen versie van <b>DbContext</b>.
					Let hier op de constructie met de <b>:base('')</b>. Hier wordt de naam van de connectie-string aangegeven.
				</p>
				
				<!-- Code snippet -->
				<pre class="prettyprint linenums">
public class MyContext : DbContext
{
   public MyContext() : base("name=MyContext")
   {

   }
   
   public DbSet&lt;Product&gt; Products { get; set; }
}</pre>
										
				<h4>POCO's</h4>
				
				<p>
					In je <b>DbSet</b> verwijs je naar een POCO object. Dit is een <b>partial</b> klasse die 
					representatief is voor de bijbehorende database tabel. Er zijn <b>attributen</b> die hier handig zijn. 
				</p>
				<ul>
					<li><b>[Key]</b></li>
					<li><b>[Table("Table Name")]</b></li>
				</ul>

				<!-- Code snippet -->
				<pre class="prettyprint linenums">
[Table("Product")]
public partial class Product
{
    [Key]
    public int Id { get; set; }
    public String Name { get; set; }
    public String Descr { get; set; }
    public String ImageUrl { get; set; }
}</pre>
			
				<p>
					Nu onze klasse klaar zijn kunnen we onze database gaan deployen. 
					Wat moeten we hiervoor doen?
				</p>
				
				<ol>
					<li>Connection string toevoegen met de naam <b>MyContext</b>.
					<li>Database Initializer aanmaken</li>
				</ol>
				
				<h4>Connection String</h4>
				
				<p>
					De eerder gemaakte <b>DbContext</b> klasse gaat in de <b>app.config</b> op zoek naar een connection string. 
					Deze connection string kunnen we uit een server explorer halen maar we kunnen hem ook zelf aanmaken. 
					De string bestaat uit 4 onderdelen. 
				</p>
					<ul>
						<li>DataSource - <b>(LocalDb)\v11.0</b> OF <b>localhost</b></li>
						<li>Initial Catalog - <b>"Naam Database"</b></li>
						<li>Integrated Security - <b>SSPI</b></li>
						<li>providerName - <b>System.Data.SqlClient"</b></li>
					</ul>
						

					
				<!-- Code snippet -->
				<pre class="prettyprint linenums">
&lt;connectionStrings&gt;
  &lt;add name="MyContext" 
    connectionString="
        Data Source=(LocalDb)\v11.0;
        Initial Catalog=MyContext;
        Integrated Security=SSPI;
    " 
    providerName="System.Data.SqlClient"/ &gt;
&lt;/connectionStrings&gt;</pre>
				
				<h4>Database Initializer</h4>
			
				<p>
					Nu &quot;Entity Framework&quot; weet waar hij de database kan vinden, moeten we hem nog vertellen wat hij met deze database moet doen. 
					Er zijn verschillende mogelijkheden zoals bijvoorbeeld bij elke build een nieuwe database deployen. 
					Wij willen de database droppen en createn bij elke change (<b>DropCreateDatabaseIfModelChanges</b>).
				</p>
				
				<p>Hiervoor kunnen we onze eigen klasse schrijven die ook meteen extra acties op onze nieuwe database kan uitvoeren, 
					zoals test-data toevoegen. Super praktisch!</p>
					
				<!-- Code snippet -->
				<pre class="prettyprint linenums">	
class MyDbInitializer : DropCreateDatabaseIfModelChanges&lt;MyContext&gt;
{
  protected override void Seed(MyContext context)
  {
    //Seed data zodat je database niet leeg is
    context.Products.Add(new Product() { Name = "Kip", Descr = "Friend chicken" });
    context.SaveChanges();
  }
}</pre>			
				<p>Om deze klasse zijn werk te laten doen moeten we onze <b>app.config</b> nog even aanpassen.</p>
				
				<!-- Code snippet -->
				<pre class="prettyprint linenums">	
&lt;contexts&gt;
  &lt;context type="ProductCrud.Domain.MyContext, ProductCrud"&gt;
  &lt;databaseInitializer type="ProductCrud.Domain.MyDbInitializer, ProductCrud" /&gt;    
  &lt;/context&gt;
&lt;/contexts&gt;</pre>


				<p>En klaar is kees! Veel plezier met je Code First Setup</p>
			</section>
		</article>
		
		
		<article class="sample shadow-z-1" id="tips">
			<section class="header">
				<span>Tips and Tricks</span>
			</section>
			
			<section class="main">
				<img src="img/construction.gif" class="responsive">
			</section>
		</article>

</div>

 <!-- Deze regel javascript hebben we nodig voor het 'prettifyen' van onze code snippits -->
    <script>
        
      !function ($) {
        $(function(){
          window.prettyPrint && prettyPrint()   
        })
      }(window.jQuery)
      
    </script>
	
